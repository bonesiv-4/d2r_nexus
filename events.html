<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D2R PvP Nexus - Community & Events</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <!-- Translator for Rich Text (Markdown) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0c0a09; }
        .font-cinzel { font-family: 'Cinzel Decorative', cursive; }
        .nav-link { transition: color 0.3s ease; }
        .nav-link:hover { color: #dc2626; }
        .event-card { background-color: rgba(17, 24, 39, 0.6); border: 1px solid #374151; }
        /* Styles for the rich text content */
        .prose-styles h1, .prose-styles h2, .prose-styles h3 { color: #f3f4f6; }
        .prose-styles p { color: #d1d5db; }
        .prose-styles a { color: #ef4444; }
        .prose-styles strong { color: #ffffff; }
        .prose-styles ul { list-style-type: disc; padding-left: 1.5rem; }
    </style>
</head>
<body class="bg-stone-900 text-gray-200">

    <!-- Navigation Bar (Events link is active) -->
    <nav class="bg-black bg-opacity-80 backdrop-blur-sm sticky top-0 z-50 border-b border-red-900">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="font-cinzel text-2xl font-bold text-white">D2R PvP <span class="text-red-600">Nexus</span></div>
            <div class="space-x-8 text-lg">
                <a href="index.html" class="nav-link text-gray-300">Home</a>
                <a href="rules.html" class="nav-link text-gray-300">Rules</a>
                <a href="events.html" class="nav-link text-white font-semibold">Events</a>
                <a href="news.html" class="nav-link text-gray-300">News</a>
                <a href="ladders.html" class="nav-link text-gray-300">Ladders</a>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <header class="bg-black border-b-4 border-red-800 py-10">
        <div class="container mx-auto px-6 text-center">
            <h1 class="font-cinzel text-5xl md:text-6xl text-red-600 font-bold">Community & Events</h1>
            <p class="mt-2 text-lg text-gray-400">Join tournaments, compete for glory, and see past results.</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="py-16 md:py-24">
        <div class="container mx-auto px-6 max-w-5xl space-y-16">
            
            <!-- Upcoming Events Section -->
            <div>
                <h2 class="font-cinzel text-4xl font-bold text-white mb-8 border-l-4 border-red-600 pl-4">Upcoming Events</h2>
                <div id="upcoming-events-container" class="space-y-8">
                    <!-- Upcoming events will be loaded here -->
                </div>
            </div>

            <!-- Hall of Fame / Past Events Section -->
            <div>
                <h2 class="font-cinzel text-4xl font-bold text-white mb-8 border-l-4 border-red-600 pl-4">Hall of Fame</h2>
                <div id="past-events-container" class="space-y-8">
                    <!-- Past events will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-black border-t border-red-900">
        <div class="container mx-auto py-6 px-6 text-center text-gray-500">
            <p>&copy; 2025 D2R PvP Nexus. A community for the fans, by the fans.</p>
        </div>
    </footer>

    <script>
        // Function to create the HTML for a single event card
        function createEventCard(event) {
            const formattedDate = new Date(event.date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
            
            // Convert the rich text (Markdown) description to HTML
            const descriptionHtml = marked.parse(event.body || '');
            
            let statusTag = '';
            if (event.status === 'Upcoming') {
                statusTag = `<span class="absolute top-4 right-4 text-xs font-bold bg-blue-600 text-white px-3 py-1 rounded-full uppercase tracking-wider">${event.status}</span>`;
            } else if (event.status === 'Completed') {
                statusTag = `<span class="absolute top-4 right-4 text-xs font-bold bg-gray-600 text-gray-200 px-3 py-1 rounded-full uppercase tracking-wider">${event.status}</span>`;
            } else if (event.status === 'In Progress') {
                statusTag = `<span class="absolute top-4 right-4 text-xs font-bold bg-red-600 text-white px-3 py-1 rounded-full uppercase tracking-wider animate-pulse">${event.status}</span>`;
            }

            return `
                <div class="event-card rounded-lg p-8 relative overflow-hidden">
                    ${statusTag}
                    <h3 class="font-cinzel text-3xl text-red-600 font-bold mb-2">${event.title}</h3>
                    <p class="text-md text-gray-400 mb-6 font-semibold">${formattedDate}</p>
                    <div class="prose-styles max-w-none">
                        ${descriptionHtml}
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // *** THIS IS THE CORRECTED PATH ***
            fetch('src/_data/events.json') 
                .then(response => {
                    if (!response.ok) { throw new Error('Failed to load events.json'); }
                    return response.json();
                })
                .then(events => {
                    const upcomingContainer = document.getElementById('upcoming-events-container');
                    const pastContainer = document.getElementById('past-events-container');
                    
                    if (!events || events.length === 0) {
                        upcomingContainer.innerHTML = '<p class="text-gray-400">No upcoming events are scheduled. Check back soon!</p>';
                        pastContainer.innerHTML = '<p class="text-gray-400">No past events have been recorded.</p>';
                        return;
                    }

                    // Sort events by date, newest first
                    events.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    let upcomingHtml = '';
                    let pastHtml = '';

                    events.forEach(event => {
                        if (event.status === 'Completed') {
                            pastHtml += createEventCard(event);
                        } else {
                            // 'Upcoming' and 'In Progress' go to the top section
                            upcomingHtml += createEventCard(event);
                        }
                    });

                    if (upcomingHtml === '') {
                        upcomingContainer.innerHTML = '<p class="text-gray-400">No upcoming events are scheduled. Check back soon!</p>';
                    } else {
                        upcomingContainer.innerHTML = upcomingHtml;
                    }

                    if (pastHtml === '') {
                        pastContainer.innerHTML = '<p class="text-gray-400">No past events have been recorded.</p>';
                    } else {
                        pastContainer.innerHTML = pastHtml;
                    }
                })
                .catch(error => {
                    console.error('Error loading events data:', error);
                    document.getElementById('upcoming-events-container').innerHTML = `<p class="text-center text-red-500">Could not load events. Please try again later.</p>`;
                });
        });
    </script>
</body>
</html>
